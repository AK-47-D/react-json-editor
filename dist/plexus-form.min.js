!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):"object"==typeof exports?exports.PlexusForm=t(require("react")):e.PlexusForm=t(e.react)}(this,function(e){return function(e){function t(n){if(r[n])return r[n].exports;var s=r[n]={exports:{},id:n,loaded:!1};return e[n].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";var n=r(1),s=r(2),i=n.DOM,a={};a.string=function(e){return e.replace(/\s+/g," ").replace(/^ /,"").replace(/\u00ad/g,"")},a.integer=function(e){return e.replace(/[^-\d]/g,"").replace(/(.)-/g,"$1")},a.number=function(e){return e.replace(/[^-\.e\d]/gi,"").replace(/(e[^e]*)e/gi,"$1").replace(/([e.][^.]*)\./gi,"$1").replace(/([^e])-/gi,"$1").replace(/(e-?\d\d\d)\d/gi,"$1")};var o={};o.string=function(e){return a.string(e)},o.integer=function(e){return e?parseInt(a.integer(e)):null},o.number=function(e){return e?parseFloat(a.number(e)):null};var p=n.createClass({displayName:"UserDefinedField",normalize:function(e){var t=a[this.props.type];return t?t(e):e},parse:function(e){var t=o[this.props.type];return t?t(e):e},handleChange:function(e){var t=this.normalize(e);this.props.update(this.props.path,t,this.parse(t))},handleKeyPress:function(e){13==e.keyCode&&e.preventDefault()},render:function(){return n.createElement(this.props.component,{value:this.props.value||"",onKeyPress:this.handleKeyPress,onChange:this.handleChange})}}),u=n.createClass({displayName:"InputField",normalize:function(e){return a[this.props.type](e)},parse:function(e){return o[this.props.type](e)},handleChange:function(e){var t=this.normalize(e.target.value);this.props.update(this.props.path,t,this.parse(t))},handleKeyPress:function(e){13==e.keyCode&&e.preventDefault()},render:function(){return i.input({type:"text",name:this.props.key,value:this.props.value||"",onKeyPress:this.handleKeyPress,onChange:this.handleChange})}}),l=n.createClass({displayName:"CheckBox",handleChange:function(e){var t=e.target.checked;this.props.update(this.props.path,t,t)},render:function(){return i.input({name:this.props.key,type:"checkbox",checked:this.props.value||!1,onChange:this.handleChange})}}),h=n.createClass({displayName:"Selection",normalize:function(e){return a[this.props.type](e)},parse:function(e){return o[this.props.type](e)},handleChange:function(e){var t=this.normalize(e.target.value);this.props.update(this.props.path,t,this.parse(t))},render:function(){var e=this.props.names;return i.select({name:this.props.key,value:this.props.value||this.props.values[0],onChange:this.handleChange},this.props.values.map(function(t,r){return i.option({key:t,value:t},e[r]||t)}))}}),c=n.createClass({displayName:"FileField",loadFile:function(e){var t=new FileReader,r=e.target.files[0],n=s.merge(this.props.getValue(this.props.path),{name:r.name,type:r.type,size:r.size});this.props.update(this.props.path,n,n),t.onload=function(e){n.data=e.target.result,this.props.update(this.props.path,n,n)}.bind(this),r&&("dataURL"==this.props.mode?t.readAsDataURL(r):t.readAsText(r))},render:function(){var e=this.props.value||{},t=[i.input({key:"input",type:"file",onChange:this.loadFile}),i.dl({key:"fileProperties"},i.dt(null,"Name"),i.dd(null,e.name||"-"),i.dt(null,"Size"),i.dd(null,e.size||"-"),i.dt(null,"Type"),i.dd(null,e.type||"-"))];return b(this.props,t.concat(x(this.props)))}}),f=function(e){return null==e||0==e.length?"":"error"},m=function(e,t){var r=[];return null!=e&&e.length>0&&r.push(e),null!=t&&t.length>0&&r.push(t.join("\n")),r.join("\n\n")},d=n.createClass({displayName:"FieldWrapper",render:function(){var e=[].concat(f(this.props.errors)||[],"form-element",this.props.classes||[]);return i.div({className:e.join(" "),key:this.props.key,title:m(this.props.description,this.props.errors)},i.label({htmlFor:this.props.key},this.props.title),this.props.children)}}),g=n.createClass({displayName:"SectionWrapper",render:function(){var e=this.props.path.length,t=[].concat("form-section",e>0?"form-subsection":[],this.props.classes||[]),r=[].concat(f(this.props.errors)||[],"form-section-title");return i.fieldset({className:t.join(" "),key:this.props.key},i.legend({className:r.join(" "),title:m(this.props.description,this.props.errors)},this.props.title),this.props.children)}}),y=function(e){return{key:e.key,path:e.path,errors:e.errors,classes:s.getIn(e.schema,["x-hints","form","classes"]),title:e.schema.title,description:e.schema.description}},v=function(e,t){return n.createElement(e.fieldWrapper||d,y(e),t)},b=function(e,t){return n.createElement(e.sectionWrapper||g,y(e),t)},k=function(e,t){var r,n,s=Object.keys(t||{}),i=[];for(r in e||[])n=e[r],s.indexOf(n)>=0&&i.push(n);for(r in s)n=s[r],i.indexOf(n)<0&&i.push(n);return i},x=function(e){var t=k(e.schema["x-ordering"],e.schema.properties);return t.map(function(t){return E(s.merge(e,{schema:e.schema.properties[t],path:e.path.concat(t)}))})},C=function(e){for(var t=(e.getValue(e.path)||[]).length+1,r=[],n=0;t>n;++n)r.push(E(s.merge(e,{schema:e.schema.items,path:e.path.concat(n)})));return r},S=function(e,t){var r,n,i;return(r=s.getIn(t,["x-hints","form","selector"]))?(n=t.oneOf.map(function(e){return s.getIn(e,["properties",r,"enum",0])||""}),i=(e||{})[r]||n[0],s.merge(s.setIn(t.oneOf[n.indexOf(i)],["properties",r],s.merge(s.getIn(t,["properties",r]),{"enum":n})),{type:"object"})):void 0},j=function(e){var t=S(e.getValue(e.path),e.schema);return x(s.merge(e,{schema:t}))},I=function(e){return e.join("_")},N=function(e){var t=[].slice.call(arguments),r=Array.isArray(e)?[]:{};for(var n in e)t.indexOf(n)<0&&(r[n]=e[n]);return r},A=function(e,t){var r=e.$ref;if(r){if(!r.match(/^#(\/([a-zA-Z_][a-zA-Z_0-9]*|[0-9]+))*$/))throw new Error("reference "+r+" has unsupported format");return s.merge(s.getIn(t,r.split("/").slice(1)),N(e,"$ref"))}return e},E=function(e){var t=A(e.schema,e.context),r=t["x-hints"]||{},i=s.getIn(r,["form","inputComponent"]);if(e=s.merge(e,{schema:t,key:I(e.path),value:e.getValue(e.path),errors:e.getErrors(e.path),type:t.type}),i)return e=s.merge(e,{component:e.handlers[i]}),v(e,n.createElement(p,e));if(r.fileUpload)return n.createElement(c,s.merge(e,{mode:r.fileUpload.mode}));if(t.oneOf)return b(e,j(e));if(t["enum"])return e=s.merge(e,{values:t["enum"],names:t.enumNames||t["enum"]}),v(e,n.createElement(h,e));switch(t.type){case"boolean":return v(e,n.createElement(l,e));case"object":return b(e,x(e));case"array":return b(e,C(e));case"number":case"integer":case"string":default:return v(e,n.createElement(u,e))}},F=function(e,t,r){var n,i,a=A(t,r);if(a.oneOf&&(a=S(e,a,r)),a["enum"])n=e||a["enum"][0];else if("object"==a.type){n=s.merge(e);for(i in a.properties)n[i]=F((e||{})[i],a.properties[i],r)}else if("array"==a.type)for(n=[],i=0;i<(e||[]).length;++i)n[i]=F((e||[])[i],a.items,r);else n=e;return n},O=function(e){var t,r,n={};for(t=0;t<e.length;++t)r=e[t],n[I(r.path)]=r.errors;return n},P=function(e,t,r){return s.prune(F(e,t,r))},z=function(e){return e.context||e.schema},K=n.createClass({displayName:"Form",getInitialState:function(){var e=this.props.values,t=this.validate(this.props.schema,e,z(this.props));return{values:e,output:e,errors:t}},componentWillReceiveProps:function(e){var t=e.values||this.state.values,r=e.values||this.state.output;this.setState({values:t,output:r,errors:this.validate(e.schema,r,z(e))})},setValue:function(e,t,r){var n=this.props.schema,i=z(this.props),a=P(s.setIn(this.state.values,e,t),n,i),o=P(s.setIn(this.state.output,e,r),n,i),p=this.validate(n,o,i);this.props.submitOnChange?this.props.onSubmit(o,null,p):this.setState({values:a,output:o,errors:p})},getValue:function(e){return s.getIn(this.state.values,e)},getErrors:function(e){return this.state.errors[I(e)]},validate:function(e,t,r){return O(this.props.validate(e,t,r))},preventSubmit:function(e){e.preventDefault()},handleSubmit:function(e){this.props.onSubmit(this.state.output,e.target.value,this.state.errors)},handleKeyPress:function(e){13==e.keyCode&&this.props.enterKeySubmits&&this.props.onSubmit(this.state.output,this.props.enterKeySubmits)},renderButtons:function(){var e=this.handleSubmit;if("function"==typeof this.props.buttons)return this.props.buttons(e);var t=(this.props.buttons||["Cancel","Submit"]).map(function(t){return i.input({type:"submit",key:t,value:t,onClick:e})});return i.p(null,t)},render:function(){var e=(this.props.schema,E({schema:this.props.schema,context:z(this.props),fieldWrapper:this.props.fieldWrapper,sectionWrapper:this.props.sectionWrapper,handlers:this.props.handlers,hints:this.props.hints,path:[],update:this.setValue,getValue:this.getValue,getErrors:this.getErrors}));return i.form({onSubmit:this.preventSubmit,onKeyPress:this.handleKeyPress,className:this.props.className},this.props.extraButtons?this.renderButtons():i.span(),e,this.renderButtons())}});e.exports=K},function(t){t.exports=e},function(e){"use strict";var t=function(e){return"number"==typeof e&&e>=0&&e%1==0},r=function(){var e,r=Array.prototype.slice.call(arguments),n=[];for(e=0;e+1<r.length;e+=2)t(r[e])||(n={});for(e=0;e+1<r.length;e+=2)n[r[e]]=r[e+1];return n},n=function(){var e,t,r,n=Array.prototype.slice.call(arguments),s=n.every(Array.isArray)?[]:{};for(e in n){t=n[e];for(r in t)s[r]=t[r]}return s},s=function(e,t){return 0==t.length||void 0==e?e:s(e[t[0]],t.slice(1))},i=function(e,t,s){if(0==t.length)return s;var a=null==e?null:e[t[0]],s=i(a||[],t.slice(1),s);return n(e,r(t[0],s))},a=function(e){var t,r,n,s;if(null==e||""===e)t=null;else if(e.constructor===Array||e.constructor===Object){r=Array.isArray(e),t=r?[]:{};for(n in e)s=a(e[n]),null!=s&&(r?t.push(s):t[n]=s);0==Object.keys(t).length&&(t=null)}else t=e;return t},o=function(e,t){var r={},n={};for(key in t){var s=t[key];e(key,s)?r[key]=s:n[key]=s}return[r,n]},p=function(e,t){var r,n={};for(r in t)n[r]=e(t[r]);return n},u=function(e,t){var r,n={};for(r in t)n[e(r)]=t[r];return n};e.exports={object:r,merge:n,getIn:s,setIn:i,prune:a,split:o,map:p,mapKeys:u}}])});